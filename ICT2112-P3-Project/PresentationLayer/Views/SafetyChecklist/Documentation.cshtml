﻿@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safety Checklist</title>
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>

<div class="container" style="padding-top: 80px;">

    <form id="safetyChecklistForm" method="post" action="/DocumentationInput/UpdateSafetyChecklist">
        <table class="table">
            <thead>
                <tr>
                    <th>Location Category</th>
                </tr>
            </thead>
            <tbody>
                <!-- Kitchen Location Category -->
                <tr data-toggle="collapse" data-target="#kitchen">
                    <td><strong>Kitchen</strong></td>
                </tr>
                <tr id="kitchen" class="collapse">
                    <td>
                        <div>
                            <input type="hidden" name="LocationCategory" value="Kitchen">
                            <p>Risk Title: <input type="text" name="RiskTitle" value="Floor is slippery"></p>
                            <p>Risk Comment: <input type="text" name="RiskComment" value="Resolve this soon"></p>
                            <p>Risk Description: <input type="text" name="RiskDescription" value="Floor with water"></p>
                            <!-- Add other fields as necessary -->
                        </div>
                    </td>
                </tr>
                <!-- Bedroom Location Category -->
                <tr data-toggle="collapse" data-target="#bedroom">
                    <td><strong>Bedroom</strong></td>
                </tr>
                <tr id="bedroom" class="collapse">
                    <td>
                        <div>
                            <input type="hidden" name="LocationCategory" value="Bedroom">
                            <p>Risk Title: <input type="text" name="RiskTitle" value="Bedroom risk title"></p>
                            <p>Risk Comment: <input type="text" name="RiskComment" value="Bedroom risk comment"></p>
                            <p>Risk Description: <input type="text" name="RiskDescription" value="Messy Bedroom with random items lying around"></p>
                            <!-- Add other fields as necessary -->
                        </div>
                    </td>
                </tr>
                <!-- Bathroom Location Category -->
                <tr data-toggle="collapse" data-target="#bathroom">
                    <td><strong>Bathroom</strong></td>
                </tr>
                <tr id="bathroom" class="collapse">
                    <td>
                        <div>
                            <input type="hidden" name="LocationCategory" value="Bathroom">
                            <p>Risk Title: <input type="text" name="RiskTitle" value="Bathroom risk title"></p>
                            <p>Risk Comment: <input type="text" name="RiskComment" value="Bathroom risk comment"></p>
                            <p>Risk Description: <input type="text" name="RiskDescription" value="Broken sewage"></p>
                            <!-- Add other fields as necessary -->
                        </div>
                    </td>
                </tr>
                <!-- Living Room Location Category -->
                <tr data-toggle="collapse" data-target="#livingroom">
                    <td><strong>Living Room</strong></td>
                </tr>
                <tr id="livingroom" class="collapse">
                    <td>
                        <div>
                            <input type="hidden" name="LocationCategory" value="Living Room">
                            <p>Risk Title: <input type="text" name="RiskTitle" value="Living room risk title"></p>
                            <p>Risk Comment: <input type="text" name="RiskComment" value="Living room risk comment"></p>
                            <p>Risk Description: <input type="text" name="RiskDescription" value="Random things lying around on floor"></p>
                            <!-- Add other fields as necessary -->
                        </div>
                    </td>
                </tr>
                <!-- Entrances and Exits Location Category -->
                <tr data-toggle="collapse" data-target="#entranceexit">
                    <td><strong>Entrances and Exits</strong></td>
                </tr>
                <tr id="entranceexit" class="collapse">
                    <td>
                        <div>
                            <input type="hidden" name="LocationCategory" value="Entrances and Exits">
                            <p>Risk Title: <input type="text" name="RiskTitle" value="Entrances and exits risk title"></p>
                            <p>Risk Comment: <input type="text" name="RiskComment" value="Entrances and exits risk comment"></p>
                            <p>Risk Description: <input type="text" name="RiskDescription" value="Wet Floor"></p>
                            <!-- Add other fields as necessary -->
                        </div>
                    </td>
                </tr>
                <!-- Add more sections as necessary -->
            </tbody>
        </table>
        <div>
    <label for="pdfPassword">PDF Password:</label>
    <input type="password" id="pdfPassword" name="pdfPassword">
</div>

        <!-- Add a submit button -->
        <button type="submit" class="btn btn-primary">Save</button>
    </form>

    <!-- Export to PDF button -->
    <button id="exportPdfButton" class="btn btn-primary">Export to PDF</button>

    <div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalLabel">Crop the image</h5>
                    <button type="button" id="close" class="close" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="img-container">
                        <img id="image" src="">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="cancel" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="crop">Crop</button>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- ======= Hero Section ======= -->
<section id="hero">
    <!-- Include hero section content here -->
    <!-- Bootstrap core JavaScript-->
    <script src="../js/SafetyChecklist/jquery/jquery.min.js"></script>
    <script src="../js/SafetyChecklist/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="../js/SafetyChecklist/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="../js/SafetyChecklist/jquery-easing/jquery.easing.min.js"></script>
    <!-- Cropper -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.css">

    <script src="../js/SafetyChecklist/safetyChecklist.js"></script>

    <!-- SweetAlert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
    document.getElementById('exportPdfButton').addEventListener('click', function() {
    // Get the password value from the input field
    var pdfPassword = document.getElementById('pdfPassword').value.trim();

    // Get all sections of the form
    var sections = document.querySelectorAll('tr[data-toggle="collapse"]');
    var safetyChecklists = [];

    // Iterate over each section
    sections.forEach(function(section, index) {
        // Get input values from the section
        var locationCategory = section.querySelector('strong').textContent.trim();
        var riskTitle = section.nextElementSibling.querySelector('input[name="RiskTitle"]').value.trim();
        var riskComment = section.nextElementSibling.querySelector('input[name="RiskComment"]').value.trim();
        var riskDescription = section.nextElementSibling.querySelector('input[name="RiskDescription"]').value.trim();

        // Create a safety checklist object
        var checklist = {
            LocationCategory: locationCategory,
            RiskTitle: riskTitle,
            RiskComment: riskComment,
            RiskDescription: riskDescription
        };

        // Add the safety checklist object to the array
        safetyChecklists.push(checklist);
    });

    // Make an AJAX request to the controller action for exporting to PDF with password
    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/DocumentationInput/ExportSafetyChecklistToPDF', true);
    xhr.setRequestHeader('Content-Type', 'application/json'); // Set content type to JSON
    xhr.responseType = 'blob'; // Response type as blob for binary data
    xhr.onload = function() {
        if (this.status === 200) {
            // Create a blob URL for the response blob
            var blobUrl = window.URL.createObjectURL(this.response);
            // Create a link element to trigger the download
            var a = document.createElement('a');
            a.href = blobUrl;
            a.download = 'SafetyChecklist.pdf';
            // Append the link to the body and trigger the click event
            document.body.appendChild(a);
            a.click();
            // Remove the link element from the body
            document.body.removeChild(a);
        }
    };
    // Send the safety checklist data and password as JSON
    xhr.send(JSON.stringify({ safetyChecklists: safetyChecklists, password: pdfPassword }));
});
</script>
</section>
<!-- End Hero -->

</body>
</html>